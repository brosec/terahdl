---
import BaseLayout from "../layouts/BaseLayout.astro";
import GlassCard from "../components/GlassCard.jsx";
import Downloader from "../components/Downloader.jsx";
import Turnstile from "../components/Turnstile.jsx";

const surl = Astro.url.searchParams.get("surl");
---

<BaseLayout
  title="Download TeraBox File"
  description="View and download details of your public TeraBox shared file."
>
  <GlassCard>

    {!surl ? (
      <>
        <h1 class="text-xl font-semibold mb-2">TeraBox Download</h1>
        <p class="text-slate-400">
          Enter a valid TeraBox share link from the homepage to continue.
        </p>
      </>
    ) : (
      <div client:load id="app"></div>
    )}

  </GlassCard>
</BaseLayout>

{ srl && false }



{ srl && false }
<script type="module">
  import React from "react";
  import { createRoot } from "react-dom/client";
  import Downloader from "../components/Downloader.jsx";
  import Turnstile from "../components/Turnstile.jsx";

  const surl = new URLSearchParams(location.search).get("surl");
  const root = createRoot(document.getElementById("app"));

  function App() {
    const [token, setToken] = React.useState(null);

    return (
      <>
        {!token && (
          <>
            <p className="text-slate-400 mb-2">
              Please verify to continue.
            </p>
            <Turnstile onVerify={setToken} />
          </>
        )}

        {token && <Downloader surl={surl} token={token} />}
      </>
    );
  }

  root.render(<App />);
</script>
